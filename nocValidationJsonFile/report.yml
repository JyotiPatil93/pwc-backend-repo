ReportDefinitions:
- reportName: RevenueCollectionReportSectorWise
  summary: Revenue Collection report Sector Wise
  version: 1.0.0
  moduleName: egov-opmsService
  sourceColumns:
  - name: applcationType
    label: report.tl.applcationType
    type: string
    source: tl
    total: false
  - name: sector
    label: report.tl.sector
    type: string
    source: tl
    total: false
  - name: totalNoOfApplicationApproved
    label: report.tl.totalNoOfApplicationApproved
    type: string
    source: tl
    total: false
  - name: revenueCollected
    label: report.tl.revenueCollected
    type: string
    source: tl
    total: false
  - name: totalNoApplicationApprovedWithNilCharges
    label: report.tl.totalNoApplicationApprovedWithNilCharges
    type: string
    source: tl
    total: false
  additionalConfig:
    reportTitle: reports.tl.RevenueCollectionReportSectorWise.title
  query:  SELECT finalResult.application_type AS applcationType, finalResult.sector AS sector, SUM(finalResult.noofapplicationproccessed) AS totalNoOfApplicationApproved, SUM(finalResult.revenuecollected) AS revenueCollected, SUM(finalResult.totalnoapplicationapprovedwithnilcharges) AS totalNoApplicationApprovedWithNilCharges FROM (SELECT a.application_type, a.sector, Count(DISTINCT( a.application_uuid )) noOfApplicationProccessed, SUM(Coalesce(a.amount, 0)) revenueCollected, CASE WHEN Coalesce(Max(( b.application_detail :: jsonb -> 'exemptedCategory' ):: text), '0') <> '1' THEN SUM(Coalesce(a.amount, 0)) ELSE 0 END totalNoApplicationApprovedWithNilCharges FROM egpm_noc_application a left join egpm_noc_application_detail b ON a.application_uuid = b.application_uuid WHERE To_date(a.applied_date :: DATE :: text, 'YYYY/MM/DD') >= To_date($fromDate, 'DD/MM/YYYY') AND To_date(a.applied_date :: DATE :: text, 'YYYY/MM/DD') <= To_date($toDate, 'DD/MM/YYYY') AND trim(a.sector)=(CASE WHEN $sector<>'' THEN $sector ELSE trim(a.sector) END) GROUP BY a.application_type, a.sector) finalResult GROUP BY finalResult.application_type, finalResult.sector